<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immersive AI Classroom</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@1.3.3/dist/universal-sentence-encoder.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .side-panel {
            position: fixed;
            top: 0;
            height: 100%;
            width: 300px;
            z-index: 100;
            transition: transform 0.3s ease-in-out;
        }
        .left-panel {
            left: 0;
            transform: translateX(-270px);
        }
        .right-panel {
            right: 0;
            transform: translateX(270px);
        }
        .side-panel:hover, .side-panel.active {
            transform: translateX(0);
        }
        .panel-tab {
            position: absolute;
            top: 50%;
            width: 30px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .left-panel .panel-tab {
            right: -30px;
            border-radius: 0 15px 15px 0;
        }
        .right-panel .panel-tab {
            left: -30px;
            border-radius: 15px 0 0 15px;
        }
        .center-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            width: 60%;
            max-height: 80%;
            overflow-y: auto;
        }
        .bottom-panel {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
        }
        .icon-button {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            margin: 5px;
        }
        .scrollable {
            max-height: calc(100vh - 100px);
            overflow-y: auto;
        }
        .tree-structure ul {
            list-style-type: none;
            padding-left: 1.5em;
        }
        .tree-structure li {
            position: relative;
            padding-left: 1em;
        }
        .tree-structure li::before {
            content: "";
            position: absolute;
            top: 0;
            left: -1em;
            width: 1em;
            height: 100%;
            border-left: 1px solid #ffffff;
        }
        .tree-structure li:last-child::before {
            height: 1em;
        }
        .tree-structure li::after {
            content: "";
            position: absolute;
            top: 1em;
            left: -1em;
            width: 1em;
            border-top: 1px solid #ffffff;
        }
        .conversation-player {
            position: relative;
            height: 300px;
            overflow: hidden;
        }
        .conversation-content {
            position: absolute;
            bottom: 0;
            width: 100%;
            transition: transform 0.5s ease-out;
        }
        .conversation-message {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .conversation-message.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div id="canvas-container"></div>
    
    <div class="side-panel left-panel glass-panel p-4">
        <div class="panel-tab glass-panel bg-blue-500">
            <i class="fas fa-chevron-right"></i>
        </div>
        <div class="panel-content scrollable">
            <h2 class="text-xl font-bold mb-2">Learning Path</h2>
            <div id="learning-path-content" class="tree-structure"></div>
        </div>
    </div>

    <div class="side-panel right-panel glass-panel p-4">
        <div class="panel-tab glass-panel bg-green-500">
            <i class="fas fa-chevron-left"></i>
        </div>
        <div class="panel-content scrollable">
            <h2 class="text-xl font-bold mb-2">Navigation</h2>
            <div id="navigation-content" class="tree-structure"></div>
        </div>
    </div>
   
    <div class="center-panel glass-panel p-4">
        <h1 class="text-xl font-bold mb-8">ClassroomsAI.com</h1>
        <h2 class="text-xl font-bold mb-2">AI Assistant</h2>
        <div id="conversation-player" class="conversation-player mb-2">
            <div id="conversation-content" class="conversation-content"></div>
        </div>
        <input type="text" id="ai-input" placeholder="Ask your AI assistant..." class="w-full p-2 bg-gray-700 text-white rounded">
        <h2 class="text-xl font-bold mt-4 mb-2">Current Role: <span id="current-role"></span></h2>
        <div id="role-buttons" class="flex flex-wrap"></div>
        <div id="generated-resources" class="mt-4"></div>
        <div id="conversation-loader" class="mt-4">
            <h3 class="text-lg font-bold mb-2">Load Previous Conversations</h3>
            <select id="conversation-select" class="w-full p-2 bg-gray-700 text-white rounded">
                <option value="">Select a conversation</option>
            </select>
        </div>
    </div>

    <div class="bottom-panel glass-panel p-4 flex space-x-2">
        <button id="voice-input" class="icon-button bg-green-600 text-white hover:bg-green-700 transition-colors" title="Voice Input">
            <i class="fas fa-microphone"></i>
        </button>
        <button id="text-input" class="icon-button bg-blue-600 text-white hover:bg-blue-700 transition-colors" title="Text Input">
            <i class="fas fa-keyboard"></i>
        </button>
        <button id="file-upload" class="icon-button bg-yellow-600 text-white hover:bg-yellow-700 transition-colors" title="Upload 3D Model">
            <i class="fas fa-file-upload"></i>
        </button>
        <button id="change-environment" class="icon-button bg-purple-600 text-white hover:bg-purple-700 transition-colors" title="Change Environment">
            <i class="fas fa-globe"></i>
        </button>
        <button id="collaborate" class="icon-button bg-red-600 text-white hover:bg-red-700 transition-colors" title="Collaborate">
            <i class="fas fa-users"></i>
        </button>
    </div>

    <input type="file" id="file-input" style="display: none;" accept=".glb,.gltf">

    <script>
        // Three.js setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        const loader = new THREE.GLTFLoader();

        camera.position.z = 5;

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404040);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        scene.add(directionalLight);

        // Interactive objects
        const interactiveObjects = [];

        function loadEnvironment(modelPath) {
            loader.load(modelPath, (gltf) => {
                scene.clear();
                scene.add(gltf.scene);
                gltf.scene.traverse((child) => {
                    if (child.isMesh) {
                        child.material.color.setHex(0x00ff00);
                        child.material.wireframe = true;
                        interactiveObjects.push(child);
                    }
                });
            }, undefined, (error) => {
                console.error('An error happened', error);
            });
        }

        loadEnvironment('path/to/default_environment.glb');

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // Raycaster for object interaction
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
            checkIntersection();
        }

        function checkIntersection() {
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactiveObjects);
            interactiveObjects.forEach(obj => obj.material.color.setHex(0x00ff00));
            if (intersects.length > 0) {
                intersects[0].object.material.color.setHex(0xff0000);
            }
        }

        window.addEventListener('mousemove', onMouseMove, false);

        // AI Assistant functionality
        const aiMessages = document.getElementById('ai-messages');
        const aiInput = document.getElementById('ai-input');
        const learningPathContent = document.getElementById('learning-path-content');
        const navigationContent = document.getElementById('navigation-content');
        const currentRoleElement = document.getElementById('current-role');
        const roleButtons = document.getElementById('role-buttons');
        const generatedResources = document.getElementById('generated-resources');

        let model;
        let currentRole = 'Student';
        const roles = ['Student', 'Teacher', 'Researcher'];

        async function loadAIModel() {
            model = await use.load();
        }

        loadAIModel();

        function addAIMessage(message) {
            const messageElement = document.createElement('p');
            messageElement.textContent = message;
            aiMessages.appendChild(messageElement);
            aiMessages.scrollTop = aiMessages.scrollHeight;
        }

        async function generateAIResponse(input) {
            const inputEmbedding = await model.embed([input]);
            // In a real implementation, we would use this embedding to query a more sophisticated AI model
            // For now, we'll use a simple keyword matching system
            if (input.toLowerCase().includes('solar system')) {
                return "Let's explore the solar system! I'm loading a 3D model of our planetary neighborhood.";
            } else if (input.toLowerCase().includes('dna')) {
                return "DNA is a fascinating topic. I'm rendering a 3D model of a DNA strand for us to examine.";
            } else {
                return "I understand you're interested in " + input + ". Let's explore this topic together in our 3D environment.";
            }
        }

        aiInput.addEventListener('keypress', async function(e) {
            if (e.key === 'Enter') {
                const userMessage = aiInput.value;
                addAIMessage('You: ' + userMessage);
                const aiResponse = await generateAIResponse(userMessage);
                addAIMessage('AI: ' + aiResponse);
                if (userMessage.toLowerCase().includes('solar system')) {
                    loadEnvironment('path/to/solar_system.glb');
                } else if (userMessage.toLowerCase().includes('dna')) {
                    loadEnvironment('path/to/dna_model.glb');
                }
                generateResource(userMessage);
                aiInput.value = '';
            }
        });

        // Learning path data structure
        const learningPath = {
            name: "Immersive Learning",
            icon: "fa-graduation-cap",
            children: [
                {
                    name: "Solar System",
                    icon: "fa-sun",
                    children: [
                        { name: "Planets", icon: "fa-globe" },
                        { name: "Moons", icon: "fa-moon" },
                        { name: "Asteroids", icon: "fa-meteor" }
                    ]
                },
                {
                    name: "DNA Structure",
                    icon: "fa-dna",
                    children: [
                        { name: "Nucleotides", icon: "fa-atom" },
                        { name: "Double Helix", icon: "fa-venus-double" },
                        { name: "Genetic Code", icon: "fa-code" }
                    ]
                },
                {
                    name: "Plant Biology",
                    icon: "fa-seedling",
                    children: [
                        { name: "Photosynthesis", icon: "fa-leaf" },
                        { name: "Root Systems", icon: "fa-route" },
                        { name: "Plant Cells", icon: "fa-border-all" }
                    ]
                }
            ]
        };


function renderLearningPath(node, parentElement) {
    const li = document.createElement('li');
    li.innerHTML = `<i class="fas ${node.icon} mr-2"></i>${node.name}`;
    parentElement.appendChild(li);

    if (node.children && node.children.length > 0) {
        const ul = document.createElement('ul');
        node.children.forEach(child => renderLearningPath(child, ul));
        li.appendChild(ul);
    }
}

function updateLearningPathView() {
    const learningPathContent = document.getElementById('learning-path-content');
    learningPathContent.innerHTML = '';
    const ul = document.createElement('ul');
    renderLearningPath(learningPath, ul);
    learningPathContent.appendChild(ul);
}

function renderLearningPath(node, parentElement) {
    const li = document.createElement('li');
    li.innerHTML = `<i class="fas ${node.icon} mr-2"></i>${node.name}`;
    parentElement.appendChild(li);

    if (node.children && node.children.length > 0) {
        const ul = document.createElement('ul');
        node.children.forEach(child => renderLearningPath(child, ul));
        li.appendChild(ul);
    }
}

function updateLearningPathView() {
    const learningPathContent = document.getElementById('learning-path-content');
    learningPathContent.innerHTML = '';
    const ul = document.createElement('ul');
    renderLearningPath(learningPath, ul);
    learningPathContent.appendChild(ul);
}

// Navigation data structure
const navigation = {
    name: "Main Menu",
    icon: "fa-bars",
    children: [
        {
            name: "Explore",
            icon: "fa-compass",
            children: [
                { name: "3D Models", icon: "fa-cube" },
                { name: "Simulations", icon: "fa-flask" },
                { name: "Virtual Labs", icon: "fa-vr-cardboard" }
            ]
        },
        {
            name: "Learn",
            icon: "fa-book",
            children: [
                { name: "Courses", icon: "fa-chalkboard-teacher" },
                { name: "Quizzes", icon: "fa-question-circle" },
                { name: "Assignments", icon: "fa-tasks" }
            ]
        },
        {
            name: "Collaborate",
            icon: "fa-users",
            children: [
                { name: "Group Projects", icon: "fa-project-diagram" },
                { name: "Discussion Forums", icon: "fa-comments" },
                { name: "Virtual Meetups", icon: "fa-video" }
            ]
        }
    ]
};

function renderNavigation(node, parentElement) {
    const li = document.createElement('li');
    li.innerHTML = `<i class="fas ${node.icon} mr-2"></i>${node.name}`;
    parentElement.appendChild(li);

    if (node.children && node.children.length > 0) {
        const ul = document.createElement('ul');
        node.children.forEach(child => renderNavigation(child, ul));
        li.appendChild(ul);
    }
}

function updateNavigationView() {
    const navigationContent = document.getElementById('navigation-content');
    navigationContent.innerHTML = '';
    const ul = document.createElement('ul');
    renderNavigation(navigation, ul);
    navigationContent.appendChild(ul);
}

// Conversation playback
let currentConversation = [];
let playbackIndex = 0;

function loadConversation(conversation) {
    currentConversation = conversation;
    playbackIndex = 0;
    const conversationContent = document.getElementById('conversation-content');
    conversationContent.innerHTML = '';
    playNextMessage();
}

function playNextMessage() {
    if (playbackIndex < currentConversation.length) {
        const message = currentConversation[playbackIndex];
        const messageElement = document.createElement('div');
        messageElement.className = 'conversation-message mb-2';
        messageElement.textContent = `${message.sender}: ${message.text}`;
        document.getElementById('conversation-content').appendChild(messageElement);
        
        setTimeout(() => {
            messageElement.classList.add('visible');
            document.getElementById('conversation-content').style.transform = `translateY(-${messageElement.offsetHeight}px)`;
            playbackIndex++;
            setTimeout(playNextMessage, 1000);
        }, 100);
    }
}

// Load previous conversations
const previousConversations = [
    {
        id: 1,
        title: "Introduction to Solar System",
        conversation: [
            { sender: "User", text: "Can you tell me about the solar system?" },
            { sender: "AI", text: "Certainly! The solar system consists of the Sun and everything that orbits around it, including planets, moons, asteroids, and comets." },
            { sender: "User", text: "How many planets are there?" },
            { sender: "AI", text: "There are eight recognized planets in our solar system: Mercury, Venus, Earth, Mars, Jupiter, Saturn, Uranus, and Neptune." }
        ]
    },
    {
        id: 2,
        title: "DNA Structure Basics",
        conversation: [
            { sender: "User", text: "What is DNA?" },
            { sender: "AI", text: "DNA, or deoxyribonucleic acid, is a molecule that carries genetic instructions for the development, functioning, growth and reproduction of all known living organisms." },
            { sender: "User", text: "What is the structure of DNA?" },
            { sender: "AI", text: "DNA has a double helix structure, which looks like a twisted ladder. The sides of the ladder are made of alternating sugar and phosphate molecules, while the rungs are pairs of nitrogenous bases." }
        ]
    }
];

function populateConversationSelect() {
    const select = document.getElementById('conversation-select');
    previousConversations.forEach(conv => {
        const option = document.createElement('option');
        option.value = conv.id;
        option.textContent = conv.title;
        select.appendChild(option);
    });
}

document.getElementById('conversation-select').addEventListener('change', (event) => {
    const selectedConversation = previousConversations.find(conv => conv.id == event.target.value);
    if (selectedConversation) {
        loadConversation(selectedConversation.conversation);
    }
});

function updateCurrentRole() {
    currentRoleElement.textContent = currentRole;
}

function createRoleButtons() {
    roleButtons.innerHTML = '';
    roles.forEach(role => {
        const button = document.createElement('button');
        button.textContent = role;
        button.className = 'bg-gray-600 text-white p-2 rounded hover:bg-gray-700 transition-colors m-1';
        button.onclick = () => {
            currentRole = role;
            updateCurrentRole();
            updateRoleContent();
            addAIMessage(`AI: You've switched to the ${role} role. How can I assist you in this capacity?`);
        };
        roleButtons.appendChild(button);
    });
}

function generateResource(topic) {
    const resourceTypes = ['Lesson Plan', 'Interactive Quiz', 'Research Summary', '3D Model'];
    const randomType = resourceTypes[Math.floor(Math.random() * resourceTypes.length)];
    const resource = `${randomType}: ${topic}`;
    const resourceElement = document.createElement('p');
    resourceElement.textContent = resource;
    generatedResources.appendChild(resourceElement);
}

// Voice input
document.getElementById('voice-input').addEventListener('click', () => {
    if ('webkitSpeechRecognition' in window) {
        const recognition = new webkitSpeechRecognition();
        recognition.onresult = function(event) {
            const transcript = event.results[0][0].transcript;
            aiInput.value = transcript;
            aiInput.dispatchEvent(new KeyboardEvent('keypress', {'key': 'Enter'}));
        };
        recognition.start();
    } else {
        alert('Speech recognition is not supported in your browser.');
    }
});

// File upload for custom 3D models
document.getElementById('file-upload').addEventListener('click', () => {
    document.getElementById('file-input').click();
});

document.getElementById('file-input').addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const contents = e.target.result;
            loadEnvironment(contents);
        };
        reader.readAsArrayBuffer(file);
    }
});

// Environment change
document.getElementById('change-environment').addEventListener('click', () => {
    const environments = ['solar_system.glb', 'dna_model.glb', 'atom_structure.glb'];
    const randomEnvironment = environments[Math.floor(Math.random() * environments.length)];
    loadEnvironment('path/to/' + randomEnvironment);
    addAIMessage('AI: I\'ve changed the environment to explore a new topic. What would you like to know about this?');
});

// Collaboration feature (simulated)
document.getElementById('collaborate').addEventListener('click', () => {
    addAIMessage('AI: Collaboration mode activated. In a full implementation, this would allow multiple users to interact in the same 3D space.');
});

// Side panel toggle
document.querySelectorAll('.panel-tab').forEach(tab => {
    tab.addEventListener('click', () => {
        tab.parentElement.classList.toggle('active');
    });
});

// Window resize handler
window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});

// Initial setup
updateCurrentRole();
createRoleButtons();
updateLearningPathView();
updateNavigationView();
populateConversationSelect();
addAIMessage('AI: Welcome to your personalized immersive learning environment. What would you like to explore today?');
</script>
</body>
</html>